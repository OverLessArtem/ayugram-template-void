# Template file for 'ayugram-desktop'
pkgname=ayugram-desktop
version=6.3.10
revision=1
build_style=cmake
build_helper="qemu gir"
configure_args="-DTDESKTOP_API_ID=209235 \
 -DTDESKTOP_API_HASH=169ee702e1df4b6e66d80311db36cc43 \
 -DDESKTOP_APP_DISABLE_CRASH_REPORTS=ON \
 -Dtde2e_DIR='/usr/lib/cmake/Td' \
 -DWaylandScanner_EXECUTABLE=/usr/bin/wayland-scanner \
 -DQT_HOST_PATH=/usr"
hostmakedepends="pkg-config qt6-base python3 extra-cmake-modules \
 qt6-declarative-host-tools wayland-devel protobuf glib-devel kf6-kcoreaddons git"
makedepends="alsa-lib-devel boost-devel-minimal libboost_regex \
 fmt-devel ffmpeg6-devel libglib-devel \
 gobject-introspection libdbusmenu-glib-devel libopenal-devel \
 minizip-devel opus-devel xxHash-devel pulseaudio-devel range-v3 \
 qt6-svg-devel libva-devel rapidjson liblz4-devel liblzma-devel \
 MesaLib-devel qt6-wayland-devel qt6-qt5compat-devel libtd-devel \
 qt6-base-private-devel kf6-kcoreaddons-devel ada-devel \
 xcb-util-keysyms-devel hunspell-devel protobuf-devel \
 glibmm2.68-devel tg_owt rnnoise-devel jemalloc-devel qt6-declarative-devel \
 libdispatch-devel"
depends="qt6-imageformats ttf-opensans"
short_desc="Desktop Telegram client with good customization and Ghost mode"
maintainer="OverLessArtem <artemover@duck.com>"
license="GPL-3.0-or-later, OpenSSL"
homepage="https://github.com/AyuGram"
changelog="https://github.com/AyuGram/AyuGramDesktop/blob/v${version}/changelog.txt"

do_fetch() {
    git clone --branch v${version} --depth 1 --recurse-submodules https://github.com/AyuGram/AyuGramDesktop.git ${wrksrc}
}

do_extract() {
    :
}

case "$XBPS_TARGET_MACHINE" in
    armv6*) configure_args+=" -DDESKTOP_APP_DISABLE_SCUDO=true";;
    mips*) broken="unsupported";;
esac

if [ "$XBPS_WORDSIZE" -eq 32 ]; then
    nodebug=yes
fi

pre_configure() {
    CFLAGS="${CFLAGS/ -g/ -g1}"
    CXXFLAGS="${CXXFLAGS/ -g/ -g1}"
}
